# Playbook for installing ansible on all hosts
# File name: install-ansible.yml
---
- name: Install Ansible on all hosts
  hosts: all
  become: yes

  # Thi variables file is used
  vars_files:
    - ../vars.yml

  tasks:
    # Install dependencies
    - name: Install dependencies
      apt:
        name:
          - software-properties-common
          - sshpass
        state: present
        update_cache: yes

    # Install python
    # add-apt-repository ppa:deadsnakes/ppa -y && apt-get update -y
    # apt-get install python3.8 -y
    - name: Install python
      apt:
        name: python
        state: present
        update_cache: yes

    # Set up /etc/ansible/ansible.cfg
    - name: Set up /etc/ansible/ansible.cfg
      blockinfile:
        path: /etc/ansible/ansible.cfg
        create: yes
        block: |
          [ssh_connection]
          ssh_args = -C -o ControlMaster=auto -o ControlPersist=60s -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no
